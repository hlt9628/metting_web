<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简历分析结果</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        body {
            background: linear-gradient(120deg, #e0eafc 0%, #cfdef3 100%);
            min-height: 100vh;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 10px 0 10px; /* 减少顶部内边距 */
        }
        .row {
            align-items: stretch;
        }
        .result-section {
            background: #fff;
            padding: 20px; /* 减少内边距 */
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(24,144,255,0.10), 0 1.5px 8px rgba(0,0,0,0.04);
            margin-bottom: 20px; /* 减少底部外边距 */
            margin-top: 0;
            transition: box-shadow 0.3s;
            height: 100%;
        }
        .result-section:hover {
            box-shadow: 0 8px 32px rgba(24,144,255,0.18), 0 2px 12px rgba(0,0,0,0.06);
        }
        .ai-header {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin-bottom: 20px;
        }
        .ai-avatar {
            width: 60px;
            height: 60px;
            margin-right: 18px;
            border-radius: 50%;
            box-shadow: 0 2px 12px rgba(24,144,255,0.18);
            background: #e0eafc;
        }
        .ai-title {
            font-weight: 800;
            font-size: 1.3rem; /* 减小字体大小 */
            letter-spacing: 1.2px;
            background: linear-gradient(90deg, #1890ff 30%, #43e97b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .ai-badge {
            display: inline-block;
            background: linear-gradient(90deg, #e0f7fa 0%, #b2ebf2 100%);
            color: #1890ff;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 16px;
            padding: 3px 14px;
            margin-top: 4px;
            box-shadow: 0 1px 4px rgba(24,144,255,0.10);
        }
        .result-content {
            white-space: pre-wrap;
            line-height: 1.5;
            color: #222;
            font-size: 14px; /* 减小字体大小 */
            padding: 10px; /* 减少内边距 */
            background: linear-gradient(135deg,#e0f7fa 0%,#f5f5f5 100%);
            border-radius: 10px;
            border: 1.5px solid #e3f2fd;
            min-height: 60px;
            box-shadow: 0 2px 8px rgba(24,144,255,0.08);
            margin-bottom: 8px;
            transition: box-shadow 0.3s;
        }
        .result-content h3, .result-content h4 {
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-size: 1.1em;
            font-weight: 700;
            color: #1890ff;
        }
        .result-content ul {
            columns: 2;
            -webkit-columns: 2;
            -moz-columns: 2;
            column-gap: 32px;
            margin: 0 0 1em 1.2em;
            padding: 0 0 0 1em;
        }
        .result-content li {
            margin-bottom: 0.3em;
            font-size: 14px;
        }
        .btn-primary {
            background: linear-gradient(90deg, #1890ff 60%, #43e97b 100%);
            border: none;
            padding: 8px 20px; /* 减少内边距 */
            font-size: 14px; /* 减小字体大小 */
            border-radius: 30px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(24,144,255,0.12);
            transition: background 0.2s, box-shadow 0.2s, transform 0.2s;
        }
        .btn-primary:hover {
            background: linear-gradient(90deg, #40a9ff 60%, #43e97b 100%);
            box-shadow: 0 4px 16px rgba(24,144,255,0.18);
            transform: translateY(-2px) scale(1.03);
        }
        .no-result {
            color: #999;
            text-align: center;
            padding: 40px 0;
            font-size: 18px;
        }
        .echarts-card {
            background: linear-gradient(120deg, #e0eafc 0%, #f5f5f5 100%);
            border-radius: 14px;
            box-shadow: 0 2px 12px rgba(24,144,255,0.08);
            padding: 10px; /* 减少内边距 */
            margin-bottom: 10px; /* 减少底部外边距 */
        }
        .interview-section {
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 2px 12px rgba(24,144,255,0.08);
            padding: 14px 10px;
        }
        .interview-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1890ff;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }
        @media (min-width: 992px) {
            .col-lg-7 { flex: 0 0 66.666667%; max-width: 66.666667%; }
            .col-lg-5 { flex: 0 0 33.333333%; max-width: 33.333333%; }
        }
        @media (max-width: 900px) {
            .container { max-width: 100vw; }
            .result-section, .echarts-card, .interview-section { padding: 12px 2vw; }
            .ai-title { font-size: 1rem; }
            .result-content { font-size: 14px; padding: 10px 4px; }
            .btn-primary { font-size: 14px; padding: 8px 12px; }
            .result-content ul { columns: 1; }
        }
    </style>
</head>
<body>
<div class="container">
    <a href="../interview/interview.html" class="btn btn-primary mt-3">返回主页</a>
</div>
<div class="container">
    <div class="row">
        <!-- 左侧：简历分析报告 -->
        <div class="col-lg-7 col-12 mb-4">
            <div class="result-section shadow-lg animate__animated animate__fadeInDown h-100">
                <div class="ai-header">
                    <img src="https://img.icons8.com/color/96/000000/artificial-intelligence.png" alt="AI头像" class="ai-avatar">
                    <div>
                        <div class="ai-title">简历分析结果</div>
                        <div class="ai-badge">AI 智能解读</div>
                    </div>
                </div>
                <div class="result-content" id="analysisResult"></div>
                <div class="text-center mt-4">
                    <a href="resume.html" class="btn btn-primary btn-lg px-5">返回重新分析</a>
                </div>
            </div>
        </div>
        <!-- 右侧：上ECharts，下面试报告 -->
        <div class="col-lg-5 col-12 d-flex flex-column">
            <div class="echarts-card flex-grow-0">
                <div id="echartsContainer" style="width:100%;height:260px;"></div>
            </div>
            <div class="interview-section flex-grow-1 mt-3">
                <div class="interview-title">面试官点评</div>
                <div class="result-content" id="interviewReport" style="background:transparent;border:none;padding:0;min-height:auto;box-shadow:none;"></div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>

<script>
    // 从localStorage获取分析结果

    var time = new Date();
    time = time.toLocaleString()
    let userId = null;
    let resumeReport = null;
    let mettingReport = null; // 注意：Java 中可能拼写错误，应为 meetingReport？
    const marksData = [
        { name: 'knowledge', value: knowledgeMark, total: knowledgeMarkTotal },
        { name: 'skill', value: skillMark, total: skillMarkTotal },
        { name: 'logistic', value: logisticMark, total: logisticMarkTotal },
        { name: 'create', value: createMark, total: createMarkTotal },
        { name: 'language', value: lunguageMark, total: lunguageMarkTotal }, // 注意：原变量名可能拼写错误，应为 "language"
        { name: 'total', value: markTotal },
        { name: 'serialVersionUID', value: serialVersionUID }
    ];
    const analysisResult = localStorage.getItem('analysisResult');putMettingReport();
    if (analysisResult) {
        resumeReport =analysisResult
        const scorePattern = /-?\*\*得分\*\*：(\d+\/\d+)/g;
        const scoreMatches = [];
        let match;
        while ((match = scorePattern.exec(analysisResult)) !== null) {
            scoreMatches.push(match[1]);
        }

        // 提取总分计算部分内容
        const totalScorePattern = /(\d+\s*\+\s*)+\d+\s*=\s*(\d+\/\d+)/;
        const totalScoreMatch = analysisResult.match(totalScorePattern);
        scoreMatches.forEach(score => {
            marksData
        });

        if (totalScoreMatch) {
            console.log("\n总分计算：");
            console.log(totalScoreMatch[0]);
        }

        let html = analysisResult
            .replace(/(^|\n)### (.*)/g, '$1<h3>$2</h3>')
            .replace(/(^|\n)---+/g, '$1<hr style="margin:1em 0;">')
            .replace(/(^|\n)#### (.*)/g, '$1<h4>$2</h4>')
            .replace(/\*\*(.*?)\*\*/g, '<b style="color:#ff9800;">$1</b>')
            .replace(/`([^`]+)`/g, '<code style="background:#e0eafc;padding:2px 6px;border-radius:4px;">$1</code>')
            .replace(/\n- (.*)/g, '<li>$1</li>')
            .replace(/\n\d+\. (.*)/g, '<li>$1</li>')
            .replace(/\n\n/g, '<br>')
            .replace(/\n/g, '<br>');
        // 自动包裹ul
        html = html.replace(/(<li>[\s\S]*?<\/li>)/g, '<ul>$1</ul>');

        document.getElementById('analysisResult').innerHTML = html;

    } else {
        document.getElementById('analysisResult').innerHTML = '<div class="no-result">未找到分析结果，请返回重新分析</div>';
    }
    async function putMettingReport() {
        const email=localStorage.getItem('userEmail')
        const response = await fetch('http://localhost:8086/user/selectUser',{
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email
            })
        })
        const data = await response.json();
        if (data.code ==500){
            userId=data.data.userId;
        }


    }


    // 示例ECharts雷达图（可根据实际数据替换）
    var chartDom = document.getElementById('echartsContainer');
    var myChart = echarts.init(chartDom);
    var option = {
        tooltip: {},
        radar: {
            indicator: [
                { name: '专业知识', max: 10 },
                { name: '技能匹配', max: 10 },
                { name: '表达能力', max: 10 },
                { name: '逻辑思维', max: 10 },
                { name: '创新能力', max: 10 },
                { name: '抗压能力', max: 10 }
            ],
            radius: 90
        },
        series: [{
            type: 'radar',
            data: [
                {
                    value: [9.2, 9.5, 8.8, 9.0, 8.5, 8.0],
                    name: '评分'
                }
            ],
            areaStyle: { color: 'rgba(24,144,255,0.18)' },
            lineStyle: { color: '#1890ff' },
            symbol: 'circle',
            itemStyle: { color: '#1890ff' }
        }]
    };
    myChart.setOption(option);

    // 面试官点评内容（可根据实际数据替换）
    const interviewReport = `技术栈匹配度高，项目经验丰富，具备大数据开发工程师能力。建议补充云平台、算法等差异化优势，提升业务理解深度。`;
    document.getElementById('interviewReport').innerHTML = interviewReport;
</script>
</body>
</html>
